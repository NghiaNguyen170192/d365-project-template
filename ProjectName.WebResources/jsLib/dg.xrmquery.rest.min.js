var Filter,XrmQuery,XQR;!function(t){function r(t){return null==t?"null":"string"==typeof t?"'"+t+"'":"[object Date]"===Object.prototype.toString.call(t)?"DateTime'"+t.format("yyyy-MM-ddTHH:mm:ss")+"'":t.toString()}function n(t,e,n){return r(t)+" "+e+" "+r(n)}function i(t,e,n){return t+"("+r(e)+", "+r(n)+")"}function o(t,e,n){return"("+t+" "+e+" "+n+")"}function e(t,n){var e=t.pop();return void 0===e?"":t.reduceRight(function(t,e){return o(e,n,t)},e)}(t=t.REST||(t.REST={})).equals=function(t,e){return n(t,"eq",e)},t.notEquals=function(t,e){return n(t,"ne",e)},t.greaterThan=function(t,e){return n(t,"gt",e)},t.greaterThanOrEqual=function(t,e){return n(t,"ge",e)},t.lessThan=function(t,e){return n(t,"lt",e)},t.lessThanOrEqual=function(t,e){return n(t,"le",e)},t.and=function(t,e){return o(t,"and",e)},t.or=function(t,e){return o(t,"or",e)},t.not=function(t){return"not "+t},t.ands=function(t){return e(t,"and")},t.ors=function(t){return e(t,"or")},t.startsWith=function(t,e){return i("startswith",t,e)},t.substringOf=function(t,e){return i("substringof",t,e)},t.endsWith=function(t,e){return i("endswith",t,e)},t.makeGuid=function(t){return XQR.makeTag("(guid'"+t+"')")}}(Filter=Filter||{}),function(t){function r(t){return t.startsWith("{")&&t.endsWith("}")?t.substring(1,t.length-1):t}(t=t.REST||(t.REST={})).stripGUID=r,t.retrieveRecord=function(t,e){return new XQR.RetrieveRecord(t,r(e))},t.retrieveMultipleRecords=function(t){return new XQR.RetrieveMultipleRecords(t)},t.createRecord=function(t,e){return new XQR.CreateRecord(t,e)},t.updateRecord=function(t,e,n){return new XQR.UpdateRecord(t,r(e),n)},t.deleteRecord=function(t,e){return new XQR.DeleteRecord(t,r(e))}}(XrmQuery=XrmQuery||{}),function(t){function o(t){return{__str:t,toString:function(){return this.__str}}}function r(t){return t(function(t){var e,n=function(t){var e=t.toString().match(s);if(e)return{arg:e[1],body:e[2]};throw new Error("XrmQuery: Unable to properly parse function: "+t.toString())}(t),r=function(t){return new RegExp("\\b"+t+"\\.([a-zA-Z_$][0-9a-zA-Z_$]*)(\\.([a-zA-Z_$][0-9a-zA-Z_$]*))?","g")}(n.arg),i={};for(;null!=(e=r.exec(n.body));)i[e[1]]||(i[e[1]]=o(e[1])),e[3]&&(i[e[1]][e[3]]=o(e[1]+"/"+e[3]));return i}(t))}t.makeTag=o;var s=/function[^\(]*\(([a-zA-Z0-9_]+)[^\{]*\{([\s\S]*)\}$/m;function i(){}function e(t,e){this.selects=[],this.expands=[],this.logicalName=r(t).toString(),this.id=e}function n(t){this.selects=[],this.expands=[],this.ordering=[],this.skipAmount=null,this.topAmount=null,this.logicalName=r(t).toString()}function u(t,e){this.logicalName=r(t).toString(),this.record=e}function c(t,e,n){this.logicalName=r(t).toString(),this.id=e,this.record=n}function l(t,e){this.logicalName=r(t).toString(),this.id=e}e.prototype.select=function(t){return this.selects=this.selects.concat(r(t)),this},e.prototype.expand=function(t,e){var n=r(t).toString();return this.expands.push(n),e&&(this.selects=this.selects.concat(r(e).map(function(t){return n+"."+t}))),this},e.prototype.execute=function(t,e){SDK.REST.retrieveRecord(this.id,this.logicalName,0<this.selects.length?this.selects.join(","):null,0<this.expands.length?this.expands.join(","):null,t,e||i)},t.RetrieveRecord=e,n.prototype.select=function(t){return this.selects=this.selects.concat(r(t)),this},n.prototype.expand=function(t,e){var n=r(t).toString();return this.expands.push(n),e&&(this.selects=this.selects.concat(r(e).map(function(t){return n+"/"+t}))),this},n.prototype.filter=function(t){return this.filters=r(t),this},n.prototype.orFilter=function(t){return this.filters?this.filters=Filter.REST.or(this.filters,r(t)):this.filter(t),this},n.prototype.andFilter=function(t){return this.filters?this.filters=Filter.REST.and(this.filters,r(t)):this.filter(t),this},n.prototype.order=function(t,e){return this.ordering.push(r(t)+" "+e),this},n.prototype.orderAsc=function(t){return this.order(t,"asc")},n.prototype.orderDesc=function(t){return this.order(t,"desc")},n.prototype.skip=function(t){return this.skipAmount=t,this},n.prototype.top=function(t){return this.topAmount=t,this},n.prototype.execute=function(t,e,n){SDK.REST.retrieveMultipleRecords(this.logicalName,this.getOptionString(),t,e,n)},n.prototype.getAll=function(e,t){var n=[];SDK.REST.retrieveMultipleRecords(this.logicalName,this.getOptionString(),function(t){n.push(t)},t||i,function(){var t;e((t=Array.prototype).concat.apply(t,n))})},n.prototype.getFirst=function(e,t){this.top(1),this.execute(function(t){return e(0<t.length?t[0]:null)},t||i,i)},n.prototype.getOptionString=function(){var t=[];return 0<this.selects.length&&t.push("$select="+this.selects.join(",")),0<this.expands.length&&t.push("$expand="+this.expands.join(",")),this.filters&&t.push("$filter="+this.filters),0<this.ordering.length&&t.push("$orderby="+this.ordering.join(",")),null!=this.skipAmount&&t.push("$skip="+this.skipAmount),null!=this.topAmount&&t.push("$top="+this.topAmount),t.join("&")},t.RetrieveMultipleRecords=n,u.prototype.execute=function(t,e){SDK.REST.createRecord(this.record,this.logicalName,t||i,e||i)},t.CreateRecord=u,c.prototype.execute=function(t,e){SDK.REST.updateRecord(this.id,this.record,this.logicalName,t||i,e||i)},t.UpdateRecord=c,l.prototype.execute=function(t,e){SDK.REST.deleteRecord(this.id,this.logicalName,t||i,e||i)},t.DeleteRecord=l}(XQR=XQR||{});
